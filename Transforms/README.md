# Importing Source data

## Offline (Preload) option

Found in Transforms module

This processes the data and creates the graph repository from scratch

It assumes data files exist in a wide variety of forms ranging from standard RF2 to specific exports such as those
generated by suppliers

To create the baseline IM2 class content follow these instructions. This can be run from IDE following a build or from
an executable.

To remove specific source files from the import if they cannot be found, comment out the various lines in the Import app
referring to the graph name

### Prerequisites

1. GRAPH DB community or standard version
2. Open search or Elastic search repository
3. Java 11.
4. 16 gig RAM (jvm -Xmx 16 gig ideal)

### Instructions for blank bulk load

Before running preload
run [TRUD Updater](https://github.com/endeavourhealth-discovery/InformationManager/tree/master/Feeds).

1. Place source files in the various folders under a single root folder.
2. If not already Install and configure a Graph DB im repository with literal index, context index bur NO inference.
3. If not already Install and configure Open Search with basic authentication
4. Take a copy of the GRAPH DB configuration Config.ttl file and place in the root of the import data folder
5. Create a directory for the temporary import data. I should not contain anything else as it will be cleared at the end
6. Configure the run time parameters for the 'ImportApp' as follows:
7. Make sure graph DB is NOT running
8. Delete the `{im}` graph repository folder (or the bulk import will fail)
9. Make sure temp folder (path provided as an argument to hold the temporary data) is empty
10. Extract emis_codes.txt and concepts.txt in ImportData/EMIS and ImportData/IMV1
11. run imports.Preload. This will throw errors if the source files are not present e.g. the unzipped Snomed RF2

### Program arguments

source={folder for importData}\
preload={folder containing the preload tool and the config.ttl}\
temp={folder to hold the temporary data}\
privacy={0 public, 1 private publisher, 2 private for authoring}\
cmd={graphdbExecutable}

### Environment variables

GRAPH_REPO=im\
GRAPH_SERVER={graphdb server url - default is http://localhost:7200}\
Q_AUTH={auth key}\
Q_URL={auth url}

### Data files

If you have run TRUD Updater these files have been added and unzipped in ImportData folder. If not then these files need
to be downloaded and unzipped manually in ImportData folder.

#### ImportData/SNOMED

SNOMED/UK Clinical - uk_sct2cl_32.12.0_20220413000001Z.zip\
https://isd.digital.nhs.uk/trud/users/authenticated/filters/0/categories/26/items/101/releases

SNOMED/UK Drug - uk_sct2dr_32.12.0_20220413000001Z.zip\
https://isd.digital.nhs.uk/trud/users/authenticated/filters/0/categories/26/items/105/releases

SNOMED/UKPC_SCT2 - ukpc_sct2_34.0.0_20220407.zip\
https://isd.digital.nhs.uk/trud/users/authenticated/filters/0/categories/8/items/659/releases

SNOMED/History Subs - uk_sctqths_32.12.0_20220413000001.zip\
https://isd.digital.nhs.uk/trud/users/authenticated/filters/0/categories/8/items/276/releases

#### ImportData/

ICD10 (5th Ed) - icd_df_10.5.0_20151102000001.zip\
https://isd.digital.nhs.uk/trud/users/authenticated/filters/0/categories/28/items/258/releases

OPCS4 (4.9) - nhs_opcs4df_9.0.0_20191104000001.zip\
https://isd.digital.nhs.uk/trud/users/authenticated/filters/0/categories/10/items/119/releases

#### ImportData/TPP

TPP (CTV3) - nhs_readctv3_25.0.0_20180401000001.zip\
https://isd.digital.nhs.uk/trud/users/authenticated/filters/0/categories/9/items/19/releases

#### ImportData/ODS

ODS - hscorgrefdataxml_data_4.0.0_20220429000001.zip (Need tool also)\
https://isd.digital.nhs.uk/trud/users/authenticated/filters/0/categories/5/items/341/releases
https://isd.digital.nhs.uk/trud/users/authenticated/filters/0/categories/5/items/343/releases

* Extract HSCOrgRefData_Full*.xml file in hscorgrefdataxml_data.zip/fullfile/
*

Run `java -Xmx4g -Xms1300M -Xmx1300M -jar Saxon\Java\Saxon9he.jar -t -s:HSCOrgRefData_Full_20220621.xml -xsl:HSCOrgRefData_xmltocsv.xslt`

#### UK Pathology - unused?

SNOMED/UK_SCT2PT - uk_sct2pt_32.12.0_20220413000001Z.zip\
https://isd.digital.nhs.uk/trud/users/authenticated/filters/0/categories/38/items/559/releases

#### Mapping - unused?

SNOMED/Mapping Tables - nhs_datamigration_29.0.0_20200401000001.zip\
https://isd.digital.nhs.uk/trud/users/authenticated/filters/0/categories/9/items/9/releases







